#!/bin/bash

# create tumx session
# param1: name
# param2: default path
# param3: type 
#			project: 
#			monitor: 
#

#---define----
init_window_list="servercode servercode servercode pb conf gdb log"

if [ $# -lt 2 ]
then
	echo "tmuxtools name default-path [ type=>{project} ]"
	exit 1 
fi

name=$1
default_path=`readlink -f $2`
show_default_path=`readlink -f ${default_path} |sed "s|$HOME/||"`
cd ${default_path}
type="default"

if [ $# -ge 3 ]
then
	type=$3
fi

remote_server_ip=`hostname -I | awk '{print $1}' | awk -F. '{print $3 "." $4}'`

if [ "$type" = "default" ]
then
	tmux new-session -d -s "${name}"
elif [ "$type" = "project" ]
then
	first=1
	for w in ${init_window_list}
	do
		if [ $first -eq 1 ]
		then
			tmux new-session -d -s "${name}" -n "$w"
			#tmux set-window-option -t "${name}" default-path "${default_path}"
			first=0
		else
			tmux new-window -t "${name}" -n "$w"
		fi
	done
	tmux set-option -t "${name}" status-right "${remote_server_ip} ${show_default_path} #(date +%%H:%%M:%%S)"
elif [ "$type" = "minotor" ]
then
	:
fi
